<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal Salat & Kalender Hijriah</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }
        .header {
            background: linear-gradient(135deg, #1e5631 0%, #006400 100%);
            color: white;
            padding: 20px 0;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .prayer-card {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            margin-bottom: 20px;
        }
        .prayer-card:hover {
            transform: translateY(-5px);
        }
        .prayer-card-header {
            background: linear-gradient(135deg, #006400 0%, #1e5631 100%);
            color: white;
            border-radius: 15px 15px 0 0;
            padding: 15px;
        }
        .prayer-time {
            font-size: 1.8rem;
            font-weight: bold;
            color: #006400;
        }
        .prayer-name {
            font-weight: bold;
            color: #333;
            font-size: 1.2rem;
        }
        .calendar-container {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .hijri-date {
            font-size: 1.5rem;
            color: #006400;
            font-weight: bold;
        }
        .location-display {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 10px 15px;
            margin-top: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        #map {
            height: 200px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .footer {
            background-color: #333;
            color: white;
            padding: 20px 0;
            margin-top: 30px;
        }
        .unesa-logo {
            max-height: 80px;
        }
        .team-member {
            background-color: white;
            border-radius: 8px;
            padding: 10px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }
        .countdown-container {
            background: linear-gradient(135deg, #006400 0%, #1e5631 100%);
            color: white;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .next-prayer {
            font-size: 1.2rem;
        }
        .countdown {
            font-size: 2rem;
            font-weight: bold;
        }
        .coordinates {
            font-size: 0.9rem;
            color: #666;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1><i class="fas fa-mosque me-2"></i>Jadwal Salat & Kalender Hijriah</h1>
                    <p class="lead">Informasi waktu salat dan kalender Hijriah sesuai lokasi Anda</p>
                </div>
                <div class="col-md-4 text-end d-none d-md-block">
                    <img src="/api/placeholder/150/80" alt="Logo Unesa" class="unesa-logo">
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="container mb-4">
        <!-- Location Section -->
        <div class="row mb-4">
            <div class="col-lg-6">
                <div class="card prayer-card">
                    <div class="card-body">
                        <h3><i class="fas fa-map-marker-alt me-2"></i>Lokasi Anda</h3>
                        <div class="location-display mb-3">
                            <div id="current-location">Mencari lokasi Anda...</div>
                            <div class="coordinates" id="coordinates"></div>
                        </div>
                        <div id="map" class="mb-3"></div>
                        <button id="change-location" class="btn btn-outline-success"><i class="fas fa-sync-alt me-2"></i>Perbarui Lokasi</button>
                    </div>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="calendar-container">
                    <h3><i class="fas fa-calendar-alt me-2"></i>Kalender Hijriah</h3>
                    <div class="current-date mb-3">
                        <div id="gregorian-date">Memuat tanggal...</div>
                        <div class="hijri-date" id="hijri-date">Memuat tanggal Hijriah...</div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead class="table-success">
                                <tr>
                                    <th>Ahad</th>
                                    <th>Senin</th>
                                    <th>Selasa</th>
                                    <th>Rabu</th>
                                    <th>Kamis</th>
                                    <th>Jumat</th>
                                    <th>Sabtu</th>
                                </tr>
                            </thead>
                            <tbody id="hijri-calendar-body">
                                <!-- Kalender akan diisi oleh JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Countdown to Next Prayer -->
        <div class="countdown-container">
            <div class="next-prayer">Waktu menuju salat berikutnya:</div>
            <div class="countdown" id="prayer-countdown">00:00:00</div>
            <div id="next-prayer-name">Memuat...</div>
        </div>

        <!-- Prayer Times -->
        <h2 class="mb-4 text-center"><i class="fas fa-clock me-2"></i>Jadwal Waktu Salat Hari Ini</h2>
        <div class="row">
            <div class="col-md-4 col-6">
                <div class="prayer-card">
                    <div class="prayer-card-header">
                        <i class="fas fa-sun me-2"></i>Subuh
                    </div>
                    <div class="card-body text-center">
                        <div class="prayer-time" id="fajr-time">--:--</div>
                        <div class="prayer-name">Subuh</div>
                    </div>
                </div>
            </div>

            <div class="col-md-4 col-6">
                <div class="prayer-card">
                    <div class="prayer-card-header">
                        <i class="fas fa-sun me-2"></i>Dzuhur
                    </div>
                    <div class="card-body text-center">
                        <div class="prayer-time" id="dhuhr-time">--:--</div>
                        <div class="prayer-name">Dzuhur</div>
                    </div>
                </div>
            </div>

            <div class="col-md-4 col-6">
                <div class="prayer-card">
                    <div class="prayer-card-header">
                        <i class="fas fa-sun me-2"></i>Ashar
                    </div>
                    <div class="card-body text-center">
                        <div class="prayer-time" id="asr-time">--:--</div>
                        <div class="prayer-name">Ashar</div>
                    </div>
                </div>
            </div>

            <div class="col-md-4 col-6">
                <div class="prayer-card">
                    <div class="prayer-card-header">
                        <i class="fas fa-sun me-2"></i>Maghrib
                    </div>
                    <div class="card-body text-center">
                        <div class="prayer-time" id="maghrib-time">--:--</div>
                        <div class="prayer-name">Maghrib</div>
                    </div>
                </div>
            </div>

            <div class="col-md-4 col-6">
                <div class="prayer-card">
                    <div class="prayer-card-header">
                        <i class="fas fa-moon me-2"></i>Isya
                    </div>
                    <div class="card-body text-center">
                        <div class="prayer-time" id="isha-time">--:--</div>
                        <div class="prayer-name">Isya</div>
                    </div>
                </div>
            </div>

            <div class="col-md-4 col-6">
                <div class="prayer-card">
                    <div class="prayer-card-header">
                        <i class="fas fa-sun me-2"></i>Terbit
                    </div>
                    <div class="card-body text-center">
                        <div class="prayer-time" id="sunrise-time">--:--</div>
                        <div class="prayer-name">Terbit Matahari</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="row">
                <div class="col-md-4 mb-4">
                    <h5>Tentang Website</h5>
                    <p>Website jadwal salat dan kalender Hijriah untuk memudahkan umat Muslim mengetahui waktu salat dan tanggal Hijriah secara akurat.</p>
                </div>
                <div class="col-md-4 mb-4">
                    <h5>Informasi</h5>
                    <div class="d-flex align-items-center mb-3">
                        <img src="/api/placeholder/80/80" alt="Logo Unesa" class="me-2" style="height: 50px;">
                        <div>
                            <p class="mb-0">Universitas Negeri Surabaya</p>
                            <p class="mb-0">Prodi S1 Informatika</p>
                            <p class="mb-0">Fakultas PSDKU Kampus Unesa 5 Magetan</p>
                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <h5>Tim Pengembang - Kelompok 3 2024C</h5>
                    <div class="team-members">
                        <div class="team-member">Restu Mahardika</div>
                        <div class="team-member">Faqih</div>
                        <div class="team-member">Rifkia</div>
                        <div class="team-member">Yussa</div>
                        <div class="team-member">Zafa Fanan</div>
                    </div>
                </div>
            </div>
            <div class="row mt-3">
                <div class="col-12 text-center">
                    <p>&copy; 2025 Kelompok 3 2024C - Universitas Negeri Surabaya</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- Scripts -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment-hijri/2.1.2/moment-hijri.min.js"></script>
    <script>
        // Variabel untuk menyimpan data lokasi dan jadwal salat
        let userLocation = {
            latitude: -7.6498,  // Default ke koordinat Magetan
            longitude: 111.3322,
            city: "Mendeteksi lokasi..."
        };
        
        let prayerTimes = {};
        let nextPrayer = {};
        
        // Fungsi untuk mengambil lokasi pengguna
        function getUserLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        userLocation.latitude = position.coords.latitude;
                        userLocation.longitude = position.coords.longitude;
                        document.getElementById('coordinates').textContent = `Koordinat: ${userLocation.latitude.toFixed(4)}, ${userLocation.longitude.toFixed(4)}`;
                        
                        // Mengambil nama kota berdasarkan koordinat (reverse geocoding)
                        fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${userLocation.latitude}&lon=${userLocation.longitude}&zoom=10`)
                            .then(response => response.json())
                            .then(data => {
                                if (data.address) {
                                    userLocation.city = data.address.city || data.address.town || data.address.village || data.address.county || "Lokasi Tidak Diketahui";
                                    document.getElementById('current-location').textContent = userLocation.city;
                                }
                            })
                            .catch(error => {
                                console.error("Error getting location name:", error);
                                document.getElementById('current-location').textContent = "Lokasi terdeteksi (nama tidak tersedia)";
                            });
                        
                        fetchPrayerTimes();
                        initMap();
                    },
                    (error) => {
                        console.error("Error getting location:", error);
                        document.getElementById('current-location').textContent = "Magetan, Jawa Timur (default)";
                        document.getElementById('coordinates').textContent = `Koordinat: ${userLocation.latitude.toFixed(4)}, ${userLocation.longitude.toFixed(4)}`;
                        fetchPrayerTimes();
                        initMap();
                    }
                );
            } else {
                document.getElementById('current-location').textContent = "Geolokasi tidak didukung oleh browser Anda";
                fetchPrayerTimes();
            }
        }
        
        // Fungsi untuk mengambil jadwal salat dari API
        function fetchPrayerTimes() {
            const today = new Date();
            const date = today.getDate();
            const month = today.getMonth() + 1;
            const year = today.getFullYear();
            
            fetch(`https://api.aladhan.com/v1/timings/${date}-${month}-${year}?latitude=${userLocation.latitude}&longitude=${userLocation.longitude}&method=11`)
                .then(response => response.json())
                .then(data => {
                    if (data.data && data.data.timings) {
                        prayerTimes = data.data.timings;
                        
                        // Memperbarui jadwal salat di UI
                        document.getElementById('fajr-time').textContent = prayerTimes.Fajr;
                        document.getElementById('dhuhr-time').textContent = prayerTimes.Dhuhr;
                        document.getElementById('asr-time').textContent = prayerTimes.Asr;
                        document.getElementById('maghrib-time').textContent = prayerTimes.Maghrib;
                        document.getElementById('isha-time').textContent = prayerTimes.Isha;
                        document.getElementById('sunrise-time').textContent = prayerTimes.Sunrise;
                        
                        updateNextPrayer();
                        setInterval(updateNextPrayer, 1000);
                    }
                })
                .catch(error => {
                    console.error("Error fetching prayer times:", error);
                });
        }
        
        // Fungsi untuk mengupdate hitung mundur ke waktu salat berikutnya
        function updateNextPrayer() {
            const now = new Date();
            const prayers = [
                { name: "Subuh", time: prayerTimes.Fajr },
                { name: "Terbit", time: prayerTimes.Sunrise },
                { name: "Dzuhur", time: prayerTimes.Dhuhr },
                { name: "Ashar", time: prayerTimes.Asr },
                { name: "Maghrib", time: prayerTimes.Maghrib },
                { name: "Isya", time: prayerTimes.Isha }
            ];
            
            // Konversi waktu salat hari ini ke objek Date
            prayers.forEach(prayer => {
                if (prayer.time) {
                    const [hour, minute] = prayer.time.split(':').map(Number);
                    const prayerTime = new Date();
                    prayerTime.setHours(hour, minute, 0, 0);
                    prayer.date = prayerTime;
                }
            });
            
            // Cari waktu salat berikutnya
            let nextPrayer = null;
            for (const prayer of prayers) {
                if (prayer.date && prayer.date > now) {
                    nextPrayer = prayer;
                    break;
                }
            }
            
            // Jika tidak ada waktu salat yang tersisa hari ini, ambil waktu subuh besok
            if (!nextPrayer && prayers[0].date) {
                nextPrayer = prayers[0];
                nextPrayer.date = new Date(prayers[0].date);
                nextPrayer.date.setDate(nextPrayer.date.getDate() + 1);
            }
            
            // Update UI dengan waktu salat berikutnya
            if (nextPrayer) {
                const diff = nextPrayer.date - now;
                const hours = Math.floor(diff / (1000 * 60 * 60));
                const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                
                document.getElementById('prayer-countdown').textContent = 
                    `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('next-prayer-name').textContent = `${nextPrayer.name}: ${nextPrayer.time}`;
            }
        }
        
        // Fungsi untuk menampilkan kalender Hijriah
        function displayHijriCalendar() {
            // Dapatkan tanggal Hijriah hari ini
            const today = moment();
            const hijriToday = today.clone().iHijri();
            const hijriMonth = hijriToday.iMonth();
            const hijriYear = hijriToday.iYear();
            const hijriDay = hijriToday.iDate();
            
            // Tampilkan tanggal Gregorian dan Hijriah
            const gregorianFormatted = today.format('dddd, D MMMM YYYY');
            const hijriMonthName = hijriToday.format('iMMMM');
            const hijriFormatted = `${hijriDay} ${hijriMonthName} ${hijriYear} H`;
            
            document.getElementById('gregorian-date').textContent = gregorianFormatted;
            document.getElementById('hijri-date').textContent = hijriFormatted;
            
            // Buat kalender Hijriah untuk bulan ini
            const firstDayOfMonth = moment().iHijri().startOf('iMonth');
            const daysInMonth = moment().iHijri().daysInMonth();
            
            // Mendapatkan hari pertama dalam minggu (0 = Minggu, 1 = Senin, dst)
            const firstDayOfWeek = firstDayOfMonth.day();
            
            let calendarHTML = '';
            let dayCount = 1;
            let weekCount = 0;
            
            // Buat baris-baris kalender
            while (dayCount <= daysInMonth) {
                calendarHTML += '<tr>';
                
                // Isi sel-sel dalam minggu
                for (let i = 0; i < 7; i++) {
                    if ((weekCount === 0 && i < firstDayOfWeek) || dayCount > daysInMonth) {
                        calendarHTML += '<td></td>';
                    } else {
                        // Tandai hari ini
                        const isToday = dayCount === hijriDay;
                        calendarHTML += `<td class="${isToday ? 'bg-success text-white' : ''}">${dayCount}</td>`;
                        dayCount++;
                    }
                }
                
                calendarHTML += '</tr>';
                weekCount++;
                
                // Jika sudah mencapai akhir bulan, hentikan loop
                if (dayCount > daysInMonth) {
                    break;
                }
            }
            
            document.getElementById('hijri-calendar-body').innerHTML = calendarHTML;
        }
        
        // Fungsi untuk menginisialisasi peta
        function initMap() {
            // Buat elemen peta sederhana dengan OpenStreetMap
            const mapElement = document.getElementById('map');
            mapElement.innerHTML = `
                <div style="width:100%;height:100%;position:relative;">
                    <iframe 
                        width="100%" 
                        height="100%" 
                        frameborder="0" 
                        scrolling="no" 
                        marginheight="0" 
                        marginwidth="0"
                        src="https://www.openstreetmap.org/export/embed.html?bbox=${userLocation.longitude - 0.01}%2C${userLocation.latitude - 0.01}%2C${userLocation.longitude + 0.01}%2C${userLocation.latitude + 0.01}&amp;layer=mapnik&amp;marker=${userLocation.latitude}%2C${userLocation.longitude}"
                        style="border:0;border-radius:10px;">
                    </iframe>
                </div>
            `;
        }
        
        // Tombol untuk memperbarui lokasi
        document.getElementById('change-location').addEventListener('click', getUserLocation);
        
        // Inisialisasi ketika halaman dimuat
        document.addEventListener('DOMContentLoaded', () => {
            getUserLocation();
            displayHijriCalendar();
        });
    </script>
</body>
</html>
